<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é¢˜ç›®æœç´¢</title>
    
    <script defer src="../toggle-theme.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe WPC', 'Segoe UI', system-ui, 'Ubuntu', 'Droid Sans', sans-serif;
            font-size: 14px;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background-color: #f8f9fa;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: flex-start;
        }
        
        .search-container {
            max-width: 1200px;
            width: 100%;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 30px;
            margin-top: 20px;
        }
        
        .search-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .search-header h1 {
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .search-box {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            align-items: center;
        }
        
        .search-input {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 16px;
            outline: none;
            transition: border-color 0.3s ease;
        }
        
        .search-input:focus {
            border-color: #007bff;
        }
        
        .search-btn {
            padding: 12px 24px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s ease;
        }
        
        .search-btn:hover {
            background-color: #0056b3;
        }
        
        .filter-options {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .filter-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .filter-group label {
            font-weight: 500;
            color: #495057;
        }
        
        .chapter-select {
            padding: 8px 12px;
            border: 1px solid #ced4da;
            border-radius: 5px;
            background-color: white;
        }
        
        .question-type-filters {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .question-type-filters label {
            display: flex;
            align-items: center;
            gap: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .results-info {
            margin-bottom: 20px;
            padding: 10px;
            background-color: #e9ecef;
            border-radius: 5px;
            font-weight: 500;
        }
        
        .question-item {
            background: #fff;
            border: 1px solid #e1e5e9;
            border-radius: 8px;
            margin-bottom: 15px;
            padding: 20px;
            transition: box-shadow 0.3s ease;
        }
        
        .question-item:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .question-header {
            display: flex;
            justify-content: between;
            align-items: flex-start;
            margin-bottom: 15px;
        }
        
        .question-meta {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .chapter-tag {
            background-color: #007bff;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .question-type-tag {
            background-color: #28a745;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .locate-btn {
            background: #4caf50;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 16px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 4px;
            margin-left: auto;
        }
        
        .locate-btn:hover {
            background: #45a049;
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .locate-btn:active {
            transform: translateY(0);
        }
        
        .question-content {
            font-size: 16px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 15px;
            line-height: 1.5;
        }
        
        .question-options {
            margin-bottom: 15px;
        }
        
        .option-item {
            padding: 8px 12px;
            margin: 5px 0;
            border-radius: 5px;
            background-color: #f8f9fa;
            border-left: 3px solid #dee2e6;
        }
        
        .option-item.correct {
            background-color: #d4edda;
            border-left-color: #28a745;
            font-weight: 500;
        }
        
        .answer-section {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            border-left: 4px solid #17a2b8;
        }
        
        .answer-label {
            font-weight: 600;
            color: #17a2b8;
            margin-bottom: 8px;
        }
        
        .answer-content {
            color: #495057;
            line-height: 1.5;
        }
        
        .no-results {
            text-align: center;
            padding: 40px;
            color: #6c757d;
            font-size: 18px;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #007bff;
            font-size: 16px;
        }
        
        /* Font size controls */
        .font-size-controls {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            margin-top: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }
        
        .font-size-controls label {
            font-weight: 600;
            color: #495057;
            font-size: 14px;
        }
        
        .font-btn {
            background: #6c757d;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.2s ease;
            min-width: 40px;
        }
        
        .font-btn:hover {
            background: #5a6268;
            transform: translateY(-1px);
        }
        
        .font-btn:active {
            transform: translateY(0);
        }
        
        #fontSizeSlider {
            width: 300px;
            height: 6px;
            border-radius: 3px;
            background: #ddd;
            outline: none;
            cursor: pointer;
        }
        
        #fontSizeSlider::-webkit-slider-thumb {
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #007bff;
            cursor: pointer;
            transition: background 0.2s ease;
        }
        
        #fontSizeSlider::-webkit-slider-thumb:hover {
            background: #0056b3;
        }
        
        #fontSizeSlider::-moz-range-thumb {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #007bff;
            cursor: pointer;
            border: none;
        }
        
        #fontSizeDisplay {
            font-weight: 600;
            color: #007bff;
            font-size: 14px;
            min-width: 40px;
            text-align: center;
        }
        
        /* Dark mode styles */
        html.dark-mode body {
            background-color: #1a1a1a;
            color: #e0e0e0;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: flex-start;
        }
        
        html.dark-mode .search-container {
            background: #2a2a2a;
            color: #e0e0e0;
        }
        
        html.dark-mode .search-input {
            background-color: #3a3a3a;
            border-color: #555;
            color: #e0e0e0;
        }
        
        html.dark-mode .search-input:focus {
            border-color: #007bff;
        }
        
        html.dark-mode .chapter-select {
            background-color: #3a3a3a;
            border-color: #555;
            color: #e0e0e0;
        }
        
        html.dark-mode .results-info {
            background-color: #3a3a3a;
            color: #e0e0e0;
        }
        
        html.dark-mode .question-item {
            background: #2a2a2a;
            border-color: #555;
        }
        
        html.dark-mode .option-item {
            background-color: #3a3a3a;
            border-left-color: #555;
        }
        
        html.dark-mode .option-item.correct {
            background-color: #1e4d2b;
            border-left-color: #28a745;
        }
        
        html.dark-mode .answer-section {
            background-color: #3a3a3a;
        }
        
        html.dark-mode .search-header h1 {
            color: #e0e0e0;
        }
        
        html.dark-mode .question-content {
            color: #e0e0e0;
        }
        
        html.dark-mode .locate-btn {
            background: #388e3c;
            color: #e8f5e8;
        }
        
        html.dark-mode .locate-btn:hover {
            background: #2e7d32;
        }
        
        html.dark-mode .answer-label {
            color: #4fc3f7;
        }
        
        html.dark-mode .answer-content {
            color: #e0e0e0;
        }
        
        /* Dark mode font controls */
        html.dark-mode .font-size-controls {
            background-color: #3a3a3a;
            border-color: #555;
        }
        
        html.dark-mode .font-size-controls label {
            color: #e0e0e0;
        }
        
        html.dark-mode .font-btn {
            background: #495057;
            color: #e0e0e0;
        }
        
        html.dark-mode .font-btn:hover {
            background: #6c757d;
        }
        
        html.dark-mode #fontSizeSlider {
            background: #555;
        }
        
        html.dark-mode #fontSizeDisplay {
            color: #4fc3f7;
        }
        
        /* Dark mode highlight styles */
        html.dark-mode mark {
            background-color: #ffc107 !important;
            color: #000 !important;
        }
        
        /* Mobile responsive styles */
        @media (max-width: 768px) {
            body {
                font-size: 16px;
                padding: 10px;
            }
            
            .search-container {
                padding: 20px;
                margin-top: 10px;
                border-radius: 8px;
            }
            
            .search-header h1 {
                font-size: 24px;
                margin-bottom: 8px;
            }
            
            .search-header p {
                font-size: 16px;
            }
            
            .search-box {
                flex-direction: column;
                gap: 12px;
            }
            
            .search-input {
                padding: 16px 20px;
                font-size: 18px;
                border-radius: 10px;
            }
            
            .search-btn {
                padding: 16px 24px;
                font-size: 18px;
                border-radius: 10px;
                width: 100%;
            }
            
            .filter-options {
                flex-direction: column;
                gap: 20px;
                align-items: stretch;
            }
            
            .filter-group {
                flex-direction: column;
                align-items: stretch;
                gap: 12px;
            }
            
            .filter-group label {
                font-size: 16px;
                font-weight: 600;
            }
            
            .chapter-select {
                padding: 12px 16px;
                font-size: 16px;
                border-radius: 8px;
            }
            
            .question-type-filters {
                flex-direction: column;
                gap: 12px;
            }
            
            .question-type-filters label {
                font-size: 16px;
                padding: 8px 0;
            }
            
            .question-type-filters input[type="checkbox"] {
                width: 18px;
                height: 18px;
            }
            
            .results-info {
                padding: 15px;
                font-size: 16px;
                border-radius: 8px;
            }
            
            .question-item {
                padding: 20px;
                margin-bottom: 20px;
                border-radius: 10px;
            }
            
            .question-meta {
                gap: 12px;
                margin-bottom: 15px;
            }
            
            .chapter-tag, .question-type-tag {
                padding: 6px 12px;
                font-size: 14px;
                border-radius: 6px;
            }
            
            .locate-btn {
                padding: 10px 16px;
                font-size: 14px;
                border-radius: 20px;
                margin-top: 10px;
                margin-left: 0;
                align-self: flex-start;
            }
            
            .question-content {
                font-size: 18px;
                line-height: 1.6;
                margin-bottom: 20px;
            }
            
            .option-item {
                padding: 12px 16px;
                margin: 8px 0;
                font-size: 16px;
                border-radius: 8px;
            }
            
            .answer-section {
                padding: 20px;
                border-radius: 8px;
                margin-top: 15px;
            }
            
            .answer-label {
                font-size: 16px;
                margin-bottom: 12px;
            }
            
            .answer-content {
                font-size: 18px;
            }
        }
        
        /* Mobile responsive styles for font controls */
        @media (max-width: 768px) {
            .font-size-controls {
                flex-wrap: wrap;
                gap: 8px;
                padding: 12px;
            }
            
            .font-size-controls label {
                font-size: 16px;
                width: 100%;
                text-align: center;
                margin-bottom: 8px;
            }
            
            .font-btn {
                padding: 10px 14px;
                font-size: 16px;
                min-width: 45px;
            }
            
            #fontSizeSlider {
                width: 200px;
                height: 8px;
            }
            
            #fontSizeSlider::-webkit-slider-thumb {
                width: 22px;
                height: 22px;
            }
            
            #fontSizeDisplay {
                font-size: 16px;
                min-width: 50px;
            }
        }
        
        @media (max-width: 480px) {
            .font-size-controls {
                padding: 10px;
            }
            
            .font-btn {
                padding: 12px 16px;
                font-size: 18px;
            }
            
            #fontSizeSlider {
                width: 180px;
            }
            
            #fontSizeDisplay {
                font-size: 18px;
            }
        }
    </style>
</head>
<body>
    <div class="search-container">
        <div class="search-header">
            <h1>ğŸ“š é¢˜ç›®æœç´¢</h1>
            <p>æœç´¢æ‰€æœ‰é¢˜ç›®ï¼Œæ”¯æŒå…³é”®è¯æœç´¢å’Œç±»å‹ç­›é€‰</p>
            
            <!-- å­—ä½“å¤§å°æ§åˆ¶ -->
            <div class="font-size-controls">
                <label for="fontSizeSlider">å­—ä½“å¤§å°:</label>
                <button class="font-btn" onclick="decreaseFontSize()">A-</button>
                <input type="range" id="fontSizeSlider" min="8" max="64" value="16" step="1" oninput="changeFontSize(this.value)">
                <button class="font-btn" onclick="increaseFontSize()">A+</button>
                <span id="fontSizeDisplay">16px</span>
            </div>
        </div>
        
        <div class="search-box">
            <input type="text" class="search-input" id="searchInput" placeholder="è¾“å…¥å…³é”®è¯æœç´¢é¢˜ç›®å†…å®¹..." />
            <button class="search-btn" onclick="searchQuestions()">ğŸ” æœç´¢</button>
        </div>
        
        <div class="filter-options">
            <div class="filter-group">
                <label>ç§‘ç›®:</label>
                <div class="question-type-filters">
                    <label><input type="checkbox" id="manufacturing" checked> åˆ¶é€ æ™ºèƒ½æŠ€æœ¯åŸºç¡€</label>
                    <label><input type="checkbox" id="data" checked> æ•°æ®æŠ€æœ¯åŸºç¡€</label>
                    <label><input type="checkbox" id="industrial" checked> å·¥ä¸šäº’è”ç½‘åŸºç¡€</label>
                </div>
            </div>
            
            <div class="filter-group">
                <label for="chapterSelect">ç« èŠ‚:</label>
                <select id="chapterSelect" class="chapter-select">
                    <option value="all">å…¨éƒ¨ç« èŠ‚</option>
                    <option value="chapter1">ç¬¬1ç«  æ¦‚è®º</option>
                    <option value="chapter2">ç¬¬2ç«  æ™ºèƒ½ä¼˜åŒ–æŠ€æœ¯</option>
                    <option value="chapter3">ç¬¬3ç«  æ¨¡å¼ä¸å›¾åƒè¯†åˆ«</option>
                    <option value="chapter3-1">ç¬¬3ç« -1 æ¨¡å¼ä¸å›¾åƒè¯†åˆ«</option>
                    <option value="chapter3-2">ç¬¬3ç« -2 æ¨¡å¼ä¸å›¾åƒè¯†åˆ«</option>
                    <option value="chapter4">ç¬¬4ç«  æ¨¡ç³Šæ§åˆ¶</option>
                    <option value="chapter5">ç¬¬5ç«  ç¥ç»ç½‘ç»œ</option>
                    <option value="chapter6">ç¬¬6ç«  å¤§æ•°æ®åŸºç¡€</option>
                    <option value="chapter7">ç¬¬7ç«  å¤§æ•°æ®å¤„ç†ç»“æ„</option>
                    <option value="chapter8">ç¬¬8ç«  åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿ HDFS</option>
                    <option value="chapter9">ç¬¬9ç«  åˆ†å¸ƒå¼æ•°æ®åº“ HBase</option>
                    <option value="chapter10">ç¬¬10ç«  NoSqlæ•°æ®åº“</option>
                    <option value="chapter11">ç¬¬11ç«  MapReduce</option>
                    <option value="chapter12">ç¬¬12ç«  Spark</option>
                    <option value="chapter13">é¢˜åº“ï¼ˆæ¨¡æ‹Ÿï¼‰</option>
                    <option value="chapter14">é€‰æ‹©é¢˜ï¼ˆæ–°ç‰ˆæ¨¡æ‹Ÿï¼‰</option>
                </select>
            </div>
            
            <div class="filter-group">
                <label>é¢˜ç›®ç±»å‹:</label>
                <div class="question-type-filters">
                    <label><input type="checkbox" id="singleChoice" checked> å•é€‰é¢˜</label>
                    <label><input type="checkbox" id="multipleChoice" checked> å¤šé€‰é¢˜</label>
                    <label><input type="checkbox" id="trueFalse" checked> åˆ¤æ–­é¢˜</label>
                    <label><input type="checkbox" id="fillBlank" checked> å¡«ç©ºé¢˜</label>
                    <label><input type="checkbox" id="essay" checked> ç®€ç­”é¢˜</label>
                </div>
            </div>
        </div>
        
        <div id="resultsInfo" class="results-info" style="display: none;"></div>
        <div id="searchResults"></div>
    </div>
    
    <script>
        let allQuestions = [];
        let filteredQuestions = [];
        let searchTimeout = null;
        
        // ç« èŠ‚æ–‡ä»¶æ˜ å°„
        const chapterFiles = {
            'chapter1': 'chapter1.html',
            'chapter2': 'chapter2.html',
            'chapter3': 'chapter3.html',
            'chapter3-1': 'chapter3-1.html',
            'chapter3-2': 'chapter3-2.html',
            'chapter4': 'chapter4.html',
            'chapter5': 'chapter5.html',
            'chapter6': 'chapter6.html',
            'chapter7': 'chapter7.html',
            'chapter8': 'chapter8.html',
            'chapter9': 'chapter9.html',
            'chapter10': 'chapter10.html',
            'chapter11': 'chapter11.html',
            'chapter12': 'chapter12.html',
            'chapter13': 'chapter13.html',
            'chapter14': 'chapter14.html'
        };
      
        // ç§‘ç›®ä¸ç« èŠ‚çš„æ˜ å°„å…³ç³»
        const subjectChapterMapping = {
            manufacturing: ['chapter1', 'chapter2', 'chapter3', 'chapter3-1', 'chapter3-2', 'chapter4', 'chapter5'],
            data: ['chapter6', 'chapter7', 'chapter8', 'chapter9', 'chapter10', 'chapter11', 'chapter12'],
            industrial: ['chapter13','chapter14']
        };
        
        // è·å–é€‰ä¸­çš„ç§‘ç›®å¯¹åº”çš„ç« èŠ‚
        function getSelectedSubjectChapters() {
            const selectedSubjects = [];
            if (document.getElementById('manufacturing').checked) selectedSubjects.push('manufacturing');
            if (document.getElementById('data').checked) selectedSubjects.push('data');
            if (document.getElementById('industrial').checked) selectedSubjects.push('industrial');
            
            if (selectedSubjects.length === 0) {
                return Object.keys(chapterFiles); // å¦‚æœæ²¡æœ‰é€‰ä¸­ä»»ä½•ç§‘ç›®ï¼Œè¿”å›æ‰€æœ‰ç« èŠ‚
            }
            
            let chapters = [];
            selectedSubjects.forEach(subject => {
                chapters = chapters.concat(subjectChapterMapping[subject]);
            });
            return chapters;
        }
        
        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', async () => {
            showLoading();
            await loadAllQuestions();
            hideLoading();
            
            // ç»‘å®šå®æ—¶æœç´¢ï¼ˆå¸¦é˜²æŠ–ï¼‰
            document.getElementById('searchInput').addEventListener('input', (e) => {
                // æ¸…é™¤ä¹‹å‰çš„å®šæ—¶å™¨
                if (searchTimeout) {
                    clearTimeout(searchTimeout);
                }
                
                // è®¾ç½®æ–°çš„å®šæ—¶å™¨ï¼Œ300msåæ‰§è¡Œæœç´¢
                searchTimeout = setTimeout(() => {
                    searchQuestions();
                }, 300);
            });
            
            // ç»‘å®šå›è½¦é”®æœç´¢ï¼ˆç«‹å³æœç´¢ï¼‰
            document.getElementById('searchInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    // æ¸…é™¤é˜²æŠ–å®šæ—¶å™¨
                    if (searchTimeout) {
                        clearTimeout(searchTimeout);
                    }
                    searchQuestions();
                }
            });
            
            // ç»‘å®šç­›é€‰å™¨å˜åŒ–äº‹ä»¶
            document.getElementById('chapterSelect').addEventListener('change', searchQuestions);
            document.querySelectorAll('.question-type-filters input').forEach(checkbox => {
                checkbox.addEventListener('change', searchQuestions);
            });
            
            // ç»‘å®šç§‘ç›®å¤é€‰æ¡†å˜åŒ–äº‹ä»¶
            document.getElementById('manufacturing').addEventListener('change', searchQuestions);
            document.getElementById('data').addEventListener('change', searchQuestions);
            document.getElementById('industrial').addEventListener('change', searchQuestions);
        });
        
        // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
        function showLoading() {
            document.getElementById('searchResults').innerHTML = '<div class="loading">æ­£åœ¨åŠ è½½é¢˜ç›®æ•°æ®...</div>';
        }
        
        // éšè—åŠ è½½çŠ¶æ€
        function hideLoading() {
            const loadingElement = document.querySelector('.loading');
            if (loadingElement) {
                loadingElement.remove();
            }
        }
        
        // åŠ è½½æ‰€æœ‰ç« èŠ‚çš„é¢˜ç›®
        async function loadAllQuestions() {
            allQuestions = [];
            
            for (const [chapterKey, fileName] of Object.entries(chapterFiles)) {
                try {
                    const response = await fetch(fileName);
                    if (response.ok) {
                        const htmlContent = await response.text();
                        const questions = parseQuestionsFromHTML(htmlContent, chapterKey);
                        allQuestions.push(...questions);
                    }
                } catch (error) {
                    console.warn(`æ— æ³•åŠ è½½ ${fileName}:`, error);
                }
            }
            
            console.log(`æ€»å…±åŠ è½½äº† ${allQuestions.length} é“é¢˜ç›®`);
        }
        
        // ä»HTMLå†…å®¹ä¸­è§£æé¢˜ç›®
        function parseQuestionsFromHTML(htmlContent, chapterKey) {
            const parser = new DOMParser();
            const doc = parser.parseFromString(htmlContent, 'text/html');
            const questions = [];
            
            // æŸ¥æ‰¾æ‰€æœ‰é¢˜ç›®æ®µè½
            const questionElements = doc.querySelectorAll('p strong');
            
            questionElements.forEach(element => {
                const questionText = element.textContent.trim();
                
                // è·³è¿‡éé¢˜ç›®å†…å®¹ - æ›´å‡†ç¡®çš„é¢˜ç›®è¯†åˆ«
                if (!questionText.match(/^\d+\s/) && !questionText.includes('å¡«ç©ºé¢˜') && !questionText.includes('åˆ¤æ–­é¢˜') && !/(ç®€ç­”|è¯´æ˜|è®ºè¿°|åˆ†æ|\[ç®€ç­”\])/.test(questionText)) {
                    return;
                }
                
                const question = {
                    chapter: chapterKey,
                    question: questionText,
                    options: [],
                    correctAnswers: [],
                    type: 'unknown'
                };
                
                // ä¼˜å…ˆæ£€æŸ¥æ˜ç¡®æ ‡æ³¨çš„é¢˜ç›®ç±»å‹
                // æ£€æŸ¥æ˜¯å¦ä¸ºå¡«ç©ºé¢˜ï¼ˆä¼˜å…ˆçº§æœ€é«˜ï¼‰
                if (/_{3,}/.test(questionText) || questionText.includes('å¡«ç©ºé¢˜')) {
                    question.type = 'fill-blank';
                    
                    // æŸ¥æ‰¾ç­”æ¡ˆ
                    let currentElement = element.parentElement.nextElementSibling;
                    while (currentElement) {
                        if (currentElement.tagName === 'DETAILS') {
                            // ä½¿ç”¨innerHTMLä¿ç•™HTMLæ ¼å¼ï¼ŒåŒ…æ‹¬å…¬å¼å’Œliæ ‡ç­¾
                            const answerHTML = currentElement.innerHTML.trim();
                            // ç§»é™¤summaryæ ‡ç­¾å†…å®¹ï¼Œä¿ç•™å…¶ä»–HTMLæ ¼å¼
                            const cleanAnswerHTML = answerHTML.replace(/<summary[^>]*>.*?<\/summary>/gi, '').trim();
                            question.correctAnswers = [cleanAnswerHTML];
                            break;
                        }
                        currentElement = currentElement.nextElementSibling;
                    }
                    
                    questions.push(question);
                    return;
                }
                
                // æ£€æŸ¥æ˜¯å¦ä¸ºç®€ç­”é¢˜
                const essayPattern = /(ç®€ç­”|è¯´æ˜|è®ºè¿°|åˆ†æ|\[ç®€ç­”\])/;
                if (essayPattern.test(questionText)) {
                    question.type = 'essay';
                    
                    // æŸ¥æ‰¾ç­”æ¡ˆ
                    let currentElement = element.parentElement.nextElementSibling;
                    while (currentElement) {
                        if (currentElement.tagName === 'DETAILS') {
                            // ä½¿ç”¨innerHTMLä¿ç•™HTMLæ ¼å¼ï¼ŒåŒ…æ‹¬å…¬å¼å’Œliæ ‡ç­¾
                            const answerHTML = currentElement.innerHTML.trim();
                            // ç§»é™¤summaryæ ‡ç­¾å†…å®¹ï¼Œä¿ç•™å…¶ä»–HTMLæ ¼å¼
                            const cleanAnswerHTML = answerHTML.replace(/<summary[^>]*>.*?<\/summary>/gi, '').trim();
                            question.correctAnswers = [cleanAnswerHTML];
                            break;
                        }
                        currentElement = currentElement.nextElementSibling;
                    }
                    
                    questions.push(question);
                    return;
                }
                
                // å¤„ç†é€‰æ‹©é¢˜å’Œåˆ¤æ–­é¢˜
                let currentElement = element.parentElement.nextElementSibling;
                
                // æŸ¥æ‰¾é€‰é¡¹åˆ—è¡¨
                while (currentElement && currentElement.tagName === 'UL' && currentElement.classList.contains('contains-task-list')) {
                    const listItems = currentElement.querySelectorAll('li.task-list-item');
                    
                    listItems.forEach(li => {
                        const checkbox = li.querySelector('input[type="checkbox"]');
                        const rawText = li.textContent.trim();
                        
                        if (checkbox && rawText) {
                            // æ¸…ç†é€‰é¡¹æ–‡æœ¬
                            const cleanText = rawText.replace(/^[A-Z]\s*[.ã€]\s*/, '');
                            question.options.push(cleanText);
                            
                            if (checkbox.checked) {
                                question.correctAnswers.push(cleanText);
                            }
                        }
                    });
                    
                    currentElement = currentElement.nextElementSibling;
                }
                
                // ç¡®å®šé¢˜ç›®ç±»å‹
                if (question.options.length > 0) {
                    if (question.correctAnswers.length > 1) {
                        question.type = 'multiple-choice';
                    } else if (question.options.length === 2 && 
                              (question.options.some(opt => opt.includes('æ­£ç¡®')) && 
                               question.options.some(opt => opt.includes('é”™è¯¯')))) {
                        question.type = 'true-false';
                    } else {
                        question.type = 'single-choice';
                    }
                    
                    questions.push(question);
                }
            });
            
            return questions;
        }
        
        // æœç´¢é¢˜ç›®
        function searchQuestions() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase().trim();
            const selectedChapter = document.getElementById('chapterSelect').value;
            const selectedSubjectChapters = getSelectedSubjectChapters();
            
            // è·å–é€‰ä¸­çš„é¢˜ç›®ç±»å‹
            const selectedTypes = [];
            if (document.getElementById('singleChoice').checked) selectedTypes.push('single-choice');
            if (document.getElementById('multipleChoice').checked) selectedTypes.push('multiple-choice');
            if (document.getElementById('trueFalse').checked) selectedTypes.push('true-false');
            if (document.getElementById('fillBlank').checked) selectedTypes.push('fill-blank');
            if (document.getElementById('essay').checked) selectedTypes.push('essay');
            
            // ç­›é€‰é¢˜ç›®
            filteredQuestions = allQuestions.filter(question => {
                // ç§‘ç›®ç­›é€‰ï¼ˆåŸºäºç« èŠ‚ï¼‰
                if (!selectedSubjectChapters.includes(question.chapter)) {
                    return false;
                }
                
                // ç« èŠ‚ç­›é€‰
                if (selectedChapter !== 'all' && question.chapter !== selectedChapter) {
                    return false;
                }
                
                // ç±»å‹ç­›é€‰
                if (!selectedTypes.includes(question.type)) {
                    return false;
                }
                
                // å…³é”®è¯æœç´¢
                if (searchTerm) {
                    const questionContent = question.question.toLowerCase();
                    const optionsContent = question.options.join(' ').toLowerCase();
                    const answersContent = question.correctAnswers.join(' ').toLowerCase();
                    
                    return questionContent.includes(searchTerm) || 
                           optionsContent.includes(searchTerm) || 
                           answersContent.includes(searchTerm);
                }
                
                return true;
            });
            
            displayResults();
        }
        
        // æ˜¾ç¤ºæœç´¢ç»“æœ
        function displayResults() {
            const resultsContainer = document.getElementById('searchResults');
            const resultsInfo = document.getElementById('resultsInfo');
            
            if (filteredQuestions.length === 0) {
                resultsInfo.style.display = 'none';
                resultsContainer.innerHTML = '<div class="no-results">ğŸ˜” æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„é¢˜ç›®</div>';
                return;
            }
            
            // æ˜¾ç¤ºç»“æœç»Ÿè®¡
            resultsInfo.style.display = 'block';
            resultsInfo.textContent = `æ‰¾åˆ° ${filteredQuestions.length} é“é¢˜ç›®`;
            
            // ç”Ÿæˆé¢˜ç›®HTML
            const questionsHTML = filteredQuestions.map((question, index) => {
                return generateQuestionHTML(question, index + 1);
            }).join('');
            
            resultsContainer.innerHTML = questionsHTML;
            
            // é‡æ–°åº”ç”¨å­—ä½“å¤§å°è®¾ç½®
            updateFontSize();
        }
        
        // é«˜äº®å…³é”®è¯å‡½æ•°
        function highlightKeywords(text, keywords) {
            if (!keywords || keywords.trim() === '') {
                return text;
            }
            
            // å°†å…³é”®è¯æŒ‰ç©ºæ ¼åˆ†å‰²ï¼Œæ”¯æŒå¤šä¸ªå…³é”®è¯
            const keywordList = keywords.trim().split(/\s+/);
            let highlightedText = text;
            
            keywordList.forEach(keyword => {
                if (keyword.length > 0) {
                    // åˆ›å»ºæ­£åˆ™è¡¨è¾¾å¼ï¼Œå¿½ç•¥å¤§å°å†™
                    const regex = new RegExp(`(${keyword.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')})`, 'gi');
                    highlightedText = highlightedText.replace(regex, '<mark style="background-color: #ffeb3b; color: #000; padding: 1px 2px; border-radius: 2px; font-weight: 600;">$1</mark>');
                }
            });
            
            return highlightedText;
        }
        
        // åœ¨HTMLå†…å®¹ä¸­é«˜äº®å…³é”®è¯ï¼Œé¿å…ç ´åHTMLç»“æ„
        function highlightKeywordsInHTML(htmlContent, keywords) {
            if (!keywords || keywords.trim() === '') {
                return htmlContent;
            }
            
            // åˆ›å»ºä¸´æ—¶DOMå…ƒç´ æ¥è§£æHTML
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = htmlContent;
            
            // é€’å½’å¤„ç†æ–‡æœ¬èŠ‚ç‚¹
            function processTextNodes(node) {
                if (node.nodeType === Node.TEXT_NODE) {
                    // å¯¹æ–‡æœ¬èŠ‚ç‚¹åº”ç”¨å…³é”®è¯é«˜äº®
                    const highlightedText = highlightKeywords(node.textContent, keywords);
                    if (highlightedText !== node.textContent) {
                        const wrapper = document.createElement('span');
                        wrapper.innerHTML = highlightedText;
                        node.parentNode.replaceChild(wrapper, node);
                    }
                } else if (node.nodeType === Node.ELEMENT_NODE) {
                    // é€’å½’å¤„ç†å­èŠ‚ç‚¹
                    const children = Array.from(node.childNodes);
                    children.forEach(child => processTextNodes(child));
                }
            }
            
            processTextNodes(tempDiv);
            return tempDiv.innerHTML;
        }
        
        // ç”Ÿæˆå•ä¸ªé¢˜ç›®çš„HTML
        function generateQuestionHTML(question, index) {
            const chapterName = getChapterName(question.chapter);
            const typeName = getTypeName(question.type);
            const searchTerm = document.getElementById('searchInput').value.toLowerCase().trim();
            
            // é«˜äº®é¢˜ç›®å†…å®¹
            const highlightedQuestion = highlightKeywords(question.question, searchTerm);
            
            let optionsHTML = '';
            if (question.options.length > 0) {
                optionsHTML = `
                    <div class="question-options">
                        ${question.options.map(option => {
                            const isCorrect = question.correctAnswers.includes(option);
                            const highlightedOption = highlightKeywords(option, searchTerm);
                            return `<div class="option-item ${isCorrect ? 'correct' : ''}">${highlightedOption}</div>`;
                        }).join('')}
                    </div>
                `;
            }
            
            let answerHTML = '';
            if (question.correctAnswers.length > 0) {
                let answersContent = '';
                if (question.type === 'essay' || question.type === 'fill-blank') {
                    // å¯¹äºç®€ç­”é¢˜å’Œå¡«ç©ºé¢˜ï¼Œç­”æ¡ˆå¯èƒ½åŒ…å«HTMLæ ¼å¼ï¼Œç›´æ¥ä½¿ç”¨HTMLå†…å®¹
                    answersContent = question.correctAnswers.map(answer => {
                        // å¯¹HTMLå†…å®¹è¿›è¡Œå…³é”®è¯é«˜äº®ï¼Œä½†è¦å°å¿ƒå¤„ç†HTMLæ ‡ç­¾
                        return highlightKeywordsInHTML(answer, searchTerm);
                    }).join('<br><br>');
                } else {
                    // å¯¹äºé€‰æ‹©é¢˜å’Œåˆ¤æ–­é¢˜ï¼Œä½¿ç”¨åŸæœ‰é€»è¾‘
                    answersContent = question.correctAnswers.map(answer => 
                        highlightKeywords(answer, searchTerm)
                    ).join('; ');
                }
                answerHTML = `
                    <div class="answer-section">
                        <div class="answer-label">å‚è€ƒç­”æ¡ˆ:</div>
                        <div class="answer-content">${answersContent}</div>
                    </div>
                `;
            }
            
            return `
                <div class="question-item">
                    <div class="question-meta">
                        <span class="chapter-tag">${chapterName}</span>
                        <span class="question-type-tag">${typeName}</span>
                        <button class="locate-btn" onclick="locateToChapter('${question.chapter}', '${question.question.replace(/'/g, "\\'")}')" title="å®šä½åˆ°é¢˜ç›®">
                            ğŸ“ å®šä½
                        </button>
                    </div>
                    <div class="question-content">${highlightedQuestion}</div>
                    ${optionsHTML}
                    ${answerHTML}
                </div>
            `;
        }
        
        // è·å–ç« èŠ‚åç§°
        function getChapterName(chapterKey) {
            const chapterNames = {
                'chapter1': 'ç¬¬1ç«  æ¦‚è®º',
                'chapter2': 'ç¬¬2ç«  æ™ºèƒ½ä¼˜åŒ–æŠ€æœ¯',
                'chapter3': 'ç¬¬3ç« -3 æ¨¡å¼ä¸å›¾åƒè¯†åˆ«',
                'chapter3-1': 'ç¬¬3ç« -1 æ¨¡å¼ä¸å›¾åƒè¯†åˆ«',
                'chapter3-2': 'ç¬¬3ç« -2 æ¨¡å¼ä¸å›¾åƒè¯†åˆ«',
                'chapter4': 'ç¬¬4ç«  æ¨¡ç³Šæ§åˆ¶',
                'chapter5': 'ç¬¬5ç«  ç¥ç»ç½‘ç»œ',
                'chapter6': 'ç¬¬6ç«  å¤§æ•°æ®åŸºç¡€',
                'chapter7': 'ç¬¬7ç«  å¤§æ•°æ®å¤„ç†ç»“æ„',
                'chapter8': 'ç¬¬8ç«  åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿ HDFS',
                'chapter9': 'ç¬¬9ç«  åˆ†å¸ƒå¼æ•°æ®åº“ HBase',
                'chapter10': 'ç¬¬10ç«  NoSqlæ•°æ®åº“',
                'chapter11': 'ç¬¬11ç«  MapReduce',
                'chapter12': 'ç¬¬12ç«  Spark',
                'chapter13': 'ç¬¬13ç«  é¢˜åº“ï¼ˆæ¨¡æ‹Ÿï¼‰'
            };
            return chapterNames[chapterKey] || chapterKey;
        }
        
        // è·å–é¢˜ç›®ç±»å‹åç§°
        function getTypeName(type) {
            const typeNames = {
                'single-choice': 'å•é€‰é¢˜',
                'multiple-choice': 'å¤šé€‰é¢˜',
                'true-false': 'åˆ¤æ–­é¢˜',
                'fill-blank': 'å¡«ç©ºé¢˜',
                'essay': 'ç®€ç­”é¢˜'
            };
            return typeNames[type] || 'æœªçŸ¥ç±»å‹';
        }
        
        // å®šä½åˆ°ç« èŠ‚å’Œé¢˜ç›®å‡½æ•°
        function locateToChapter(chapterKey, questionText = null) {
            // ç« èŠ‚æ–‡ä»¶ååˆ°ç´¢å¼•çš„æ˜ å°„ï¼ˆæ³¨æ„ï¼šç´¢å¼•0æ˜¯é¢˜ç›®æœç´¢é¡µé¢ï¼‰
            const chapterFileToIndex = {
                'chapter1': 1,
                'chapter2': 2,
                'chapter3-1': 3,
                'chapter3-2': 4,
                'chapter3': 5,
                'chapter4': 6,
                'chapter5': 7,
                'chapter6': 8,
                'chapter7': 9,
                'chapter8': 10,
                'chapter9': 11,
                'chapter10': 12,
                'chapter11': 13,
                'chapter12': 14,
                'IndustrialInternet': 15,
                'chapter13': 16
            };
            
            const chapterIndex = chapterFileToIndex[chapterKey];
            if (chapterIndex !== undefined) {
                // å‘çˆ¶é¡µé¢å‘é€æ¶ˆæ¯ï¼Œè¯·æ±‚åˆ‡æ¢åˆ°æŒ‡å®šç« èŠ‚å¹¶å®šä½é¢˜ç›®
                if (window.parent && window.parent !== window) {
                    window.parent.postMessage({
                        type: 'navigateToChapter',
                        chapterIndex: chapterIndex,
                        chapterKey: chapterKey,
                        questionText: questionText
                    }, '*');
                } else {
                    // å¦‚æœä¸åœ¨iframeä¸­ï¼Œç›´æ¥è·³è½¬åˆ°ä¸»é¡µé¢
                    const url = questionText ? 
                        `../index.html#${chapterIndex}?q=${encodeURIComponent(questionText)}` : 
                        `../index.html#${chapterIndex}`;
                    window.location.href = url;
                }
            }
        }
        
        // åˆå§‹æ˜¾ç¤ºæ‰€æœ‰é¢˜ç›®
        window.addEventListener('load', () => {
            setTimeout(() => {
                if (allQuestions.length > 0) {
                    searchQuestions();
                }
            }, 1000);
        });
        
        // å­—ä½“å¤§å°æ§åˆ¶åŠŸèƒ½
        let currentFontSize = 16;
        
        function changeFontSize(size) {
            currentFontSize = parseInt(size);
            updateFontSize();
            updateFontSizeDisplay();
        }
        
        function increaseFontSize() {
            if (currentFontSize < 64) {
                currentFontSize += 1;
                document.getElementById('fontSizeSlider').value = currentFontSize;
                updateFontSize();
                updateFontSizeDisplay();
            }
        }
        
        function decreaseFontSize() {
            if (currentFontSize > 8) {
                currentFontSize -= 1;
                document.getElementById('fontSizeSlider').value = currentFontSize;
                updateFontSize();
                updateFontSizeDisplay();
            }
        }
        
        function updateFontSize() {
            const elements = [
                '.question-content',
                '.option-item',
                '.answer-content',
                '.search-input',
                '.search-btn',
                '.chapter-select',
                '.question-type-filters label',
                '.results-info',
                '.font-size-controls label',
                '.font-btn',
                '#fontSizeDisplay',
                'body'
            ];
            
            elements.forEach(selector => {
                const nodeList = document.querySelectorAll(selector);
                nodeList.forEach(element => {
                    if (selector === 'body') {
                        element.style.fontSize = currentFontSize + 'px';
                    } else if (selector === '.question-content') {
                        element.style.fontSize = (currentFontSize + 2) + 'px';
                    } else if (selector === '.search-input' || selector === '.search-btn') {
                        element.style.fontSize = currentFontSize + 'px';
                    } else {
                        element.style.fontSize = currentFontSize + 'px';
                    }
                });
            });
            
            // ä¿å­˜å­—ä½“å¤§å°è®¾ç½®åˆ°localStorage
            localStorage.setItem('searchPageFontSize', currentFontSize);
        }
        
        function updateFontSizeDisplay() {
            document.getElementById('fontSizeDisplay').textContent = currentFontSize + 'px';
        }
        
        // é¡µé¢åŠ è½½æ—¶æ¢å¤å­—ä½“å¤§å°è®¾ç½®
        document.addEventListener('DOMContentLoaded', () => {
            const savedFontSize = localStorage.getItem('searchPageFontSize');
            if (savedFontSize) {
                currentFontSize = parseInt(savedFontSize);
                document.getElementById('fontSizeSlider').value = currentFontSize;
                updateFontSizeDisplay();
                // å»¶è¿Ÿåº”ç”¨å­—ä½“å¤§å°ï¼Œç¡®ä¿é¡µé¢å…ƒç´ å·²åŠ è½½
                setTimeout(() => {
                    updateFontSize();
                }, 100);
            }
        });
    </script>
</body>
</html>